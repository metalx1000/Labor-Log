<!DOCTYPE html>
<html lang="en">
<head>
  <title>Labor Log</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>

  <!--favicon-->
  <link rel="apple-touch-icon" sizes="57x57" href="icons/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="icons/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="icons/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="icons/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="icons/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="icons/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="icons/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="icons/apple-touch-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon-180x180.png">
  <link rel="icon" type="image/png" href="icons/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="icons/android-chrome-192x192.png" sizes="192x192">
  <link rel="icon" type="image/png" href="icons/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/png" href="icons/favicon-16x16.png" sizes="16x16">
  <link rel="manifest" href="icons/manifest.json">
  <link rel="shortcut icon" href="icons/favicon.ico">
  <meta name="apple-mobile-web-app-title" content="Labor Log">
  <meta name="application-name" content="Labor Log">
  <meta name="msapplication-TileColor" content="#2b5797">
  <meta name="msapplication-TileImage" content="icons/mstile-144x144.png">
  <meta name="msapplication-config" content="icons/browserconfig.xml">
  <meta name="theme-color" content="#ffffff">
  <script>
    var log;
    var tmplog;
    var removeIndex;
    var logLength = 10;

    $(document).ready(function(){
      if(localStorage.labor){
        log = JSON.parse(localStorage['labor']);
      }else{
        log = [];
      }

      $("#add_btn").click(function(){
        log.push(Date());
        localStorage['labor'] = JSON.stringify(log);
        //location.reload();
        update();
      });

      update();

      //remove entries

      $("#log_table").on('click','.remove',function(){
        removeIndex = $(this).attr('index');
        var msg = log[removeIndex];
        $("#removeMsg").html(msg);
        $('#removeModal').modal('show');
      });

      $("#delete").on('click',function(){
        log.splice(removeIndex,1);
        localStorage['labor'] = JSON.stringify(log);
        update();
        //location.reload();
      })

      $("#all_btn").click(function(){
        logLength = log.length;
        update();
      });
    });

    function fixTime(){
      tmplog = [];
      for(var i=0;i<log.length;i++){
        var time = new Date(log[i]); 
        time = time.getTime();
        tmplog.push(time);
      } 
      log = tmplog;
      log = log.sort();
    }

    function update(){
      fixTime();
      var last = 0;
      $("#log_table").html("");
      if(log.length > logLength){
        len = log.length - logLength;
      }else{
        len = 0;
      }

      $("#info").html("Displaying " + logLength + " of " + log.length + " Entries");
      for(var i=len;i<log.length;i++){
        var entry = log[i];
        var date = new Date(entry);
        var time = date.getTime();
        var diff = (time - last) / 1000;
        if(last == 0 && logLength == log.length){
          var minutes = "First Entry";
        }else if(last == 0 ){
          var minutes = "Previous Entries Not Shown";
        }else{
          var minutes = Math.round(diff / 60);
        }

        last = time;
        date = date.toUTCString();
        date = new Date(date);

        if(minutes > 86400){
          minutes = "More than 24 hours";
        }else if(minutes > 60){
          minutes = "More than an hour";
        }else if(minutes < 6){
          date = "<a style='font-weight: bold' class='text-danger'>" + date + "</a>";
          minutes = "<a style='font-weight: bold' class='text-danger'>" + minutes + "</a>";
        }else if(minutes < 10){
          date = "<a style='font-weight: bold'>" + date + "</a>";
          minutes = "<a style='font-weight: bold'>" + minutes + "</a>";
        }

        $("#log_table").append("<tr><td>"+
          //Contraction Logged</td><td>"+
          date+"</td><td>"+
          minutes+"</td><td>"+
        "<span index='"+i+"' class='remove glyphicon glyphicon-remove-sign' style='color:red;font-size: 2em'></span></td><td>"+
        "</tr>");
      }

      logLength = 10;
    }

  </script>
</head>
<body> 

<div class="container">
  <h2>Labor Log</h2>
  <!--<p>Click below to log contraction times</p>            -->
  <p id="info"></p>
  <button id="add_btn" type="button" class="btn btn-primary btn-block btn-lg">Add Contraction Time</button>
  <table class="table table-striped">
    <thead>
      <tr>
        <!--<th>Labor Log</th>-->
        <th>Time of Contractions</th>
        <th>Minutes Since Last</th>
        <th>Delete</th>
      </tr>
    </thead>
    <tbody id="log_table">
    </tbody>
  </table>
  <hr>
  <p>Time since last contraction is rounded to nearest minute</p>           
  <p style='font-weight: bold' class='text-primary'>Blue Bold Text = Contractions Under 10 Minutes</p> 
  <p style='font-weight: bold' class='text-danger'>Red Bold Text = Contractions 5 Minutes Or Less Apart</p> 
  <button id="all_btn" type="button" class="btn btn-primary btn-block btn-lg">View All Entries</button>
</div>

<!-- Modals-->
<!--Removel Confirm-->
<div id="removeModal" class="modal fade" role="dialog">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Would you like to remove this entry?</h4>
      </div>
      <div class="modal-body">
        <p id="removeMsg"></p>
      </div>
      <div class="modal-footer">
        <button id="delete" type="button" class="btn btn-danger" data-dismiss="modal">Delete Entry</button>
        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
      </div>
    </div>

  </div>
</div>


<!--Manual Enter-->
<div id="timeEnter" class="modal fade" role="dialog">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Please Entery Time of Contraction</h4>
      </div>
      <div class="modal-body">
        <p id="timeMsg"></p>
      </div>
      <div class="modal-footer">
        <button id="addTime" type="button" class="btn btn-default" data-dismiss="modal">Add Time</button>
        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
      </div>
    </div>

  </div>
</div>


</body>
</html>
